import{d as P,u as H,o as R,c as W,a as A,e as q,b as j,f as G,g as I}from"./index-34b6b887.js";import{s as Z,a as v}from"./axios-d99b3ecd.js";import{s as D}from"./utils-74194d15.js";const T=Math.PI,B=2*T,m=1e-6,O=B-m;function N(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Q(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return N;const n=10**t;return function(i){this._+=i[0];for(let s=1,a=i.length;s<a;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}class V{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?N:Q(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,s){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+s}`}bezierCurveTo(t,n,i,s,a,h){this._append`C${+t},${+n},${+i},${+s},${this._x1=+a},${this._y1=+h}`}arcTo(t,n,i,s,a){if(t=+t,n=+n,i=+i,s=+s,a=+a,a<0)throw new Error(`negative radius: ${a}`);let h=this._x1,f=this._y1,c=i-t,r=s-n,l=h-t,u=f-n,o=l*l+u*u;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(o>m)if(!(Math.abs(u*c-r*l)>m)||!a)this._append`L${this._x1=t},${this._y1=n}`;else{let d=i-h,_=s-f,$=c*c+r*r,x=d*d+_*_,p=Math.sqrt($),g=Math.sqrt(o),w=a*Math.tan((T-Math.acos(($+o-x)/(2*p*g)))/2),y=w/g,C=w/p;Math.abs(y-1)>m&&this._append`L${t+y*l},${n+y*u}`,this._append`A${a},${a},0,0,${+(u*d>l*_)},${this._x1=t+C*c},${this._y1=n+C*r}`}}arc(t,n,i,s,a,h){if(t=+t,n=+n,i=+i,h=!!h,i<0)throw new Error(`negative radius: ${i}`);let f=i*Math.cos(s),c=i*Math.sin(s),r=t+f,l=n+c,u=1^h,o=h?s-a:a-s;this._x1===null?this._append`M${r},${l}`:(Math.abs(this._x1-r)>m||Math.abs(this._y1-l)>m)&&this._append`L${r},${l}`,i&&(o<0&&(o=o%B+B),o>O?this._append`A${i},${i},0,1,${u},${t-f},${n-c}A${i},${i},0,1,${u},${this._x1=r},${this._y1=l}`:o>m&&this._append`A${i},${i},0,${+(o>=T)},${u},${this._x1=t+i*Math.cos(a)},${this._y1=n+i*Math.sin(a)}`)}rect(t,n,i,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+s}h${-i}Z`}toString(){return this._}}function X(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function F(){return this.eachAfter(X)}function J(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this}function K(e,t){for(var n=this,i=[n],s,a,h=-1;n=i.pop();)if(e.call(t,n,++h,this),s=n.children)for(a=s.length-1;a>=0;--a)i.push(s[a]);return this}function U(e,t){for(var n=this,i=[n],s=[],a,h,f,c=-1;n=i.pop();)if(s.push(n),a=n.children)for(h=0,f=a.length;h<f;++h)i.push(a[h]);for(;n=s.pop();)e.call(t,n,++c,this);return this}function Y(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i}function tt(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,s=i&&i.length;--s>=0;)n+=i[s].value;t.value=n})}function et(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function nt(e){for(var t=this,n=it(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var s=i.length;e!==n;)i.splice(s,0,e),e=e.parent;return i}function it(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),s=null;for(e=n.pop(),t=i.pop();e===t;)s=e,e=n.pop(),t=i.pop();return s}function rt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function st(){return Array.from(this)}function at(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function ht(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*ot(){var e=this,t,n=[e],i,s,a;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(s=0,a=i.length;s<a;++s)n.push(i[s]);while(n.length)}function S(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=ut)):t===void 0&&(t=ct);for(var n=new z(e),i,s=[n],a,h,f,c;i=s.pop();)if((h=t(i.data))&&(c=(h=Array.from(h)).length))for(i.children=h,f=c-1;f>=0;--f)s.push(a=h[f]=new z(h[f])),a.parent=i,a.depth=i.depth+1;return n.eachBefore(dt)}function lt(){return S(this).eachBefore(ft)}function ct(e){return e.children}function ut(e){return Array.isArray(e)?e[1]:null}function ft(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function dt(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function z(e){this.data=e,this.depth=this.height=0,this.parent=null}z.prototype=S.prototype={constructor:z,count:F,each:J,eachAfter:U,eachBefore:K,find:Y,sum:tt,sort:et,path:nt,ancestors:rt,descendants:st,leaves:at,links:ht,copy:lt,[Symbol.iterator]:ot};function pt(e,t){return e.parent===t.parent?1:2}function M(e){var t=e.children;return t?t[0]:e.t}function b(e){var t=e.children;return t?t[t.length-1]:e.t}function _t(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function gt(e){for(var t=0,n=0,i=e.children,s=i.length,a;--s>=0;)a=i[s],a.z+=t,a.m+=t,t+=a.s+(n+=a.c)}function $t(e,t,n){return e.a.parent===t.parent?e.a:n}function k(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}k.prototype=Object.create(z.prototype);function xt(e){for(var t=new k(e,0),n,i=[t],s,a,h,f;n=i.pop();)if(a=n._.children)for(n.children=new Array(f=a.length),h=f-1;h>=0;--h)i.push(s=n.children[h]=new k(a[h],h)),s.parent=n;return(t.parent=new k(null,0)).children=[t],t}function yt(){var e=pt,t=1,n=1,i=null;function s(r){var l=xt(r);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(h),i)r.eachBefore(c);else{var u=r,o=r,d=r;r.eachBefore(function(g){g.x<u.x&&(u=g),g.x>o.x&&(o=g),g.depth>d.depth&&(d=g)});var _=u===o?1:e(u,o)/2,$=_-u.x,x=t/(o.x+_+$),p=n/(d.depth||1);r.eachBefore(function(g){g.x=(g.x+$)*x,g.y=g.depth*p})}return r}function a(r){var l=r.children,u=r.parent.children,o=r.i?u[r.i-1]:null;if(l){gt(r);var d=(l[0].z+l[l.length-1].z)/2;o?(r.z=o.z+e(r._,o._),r.m=r.z-d):r.z=d}else o&&(r.z=o.z+e(r._,o._));r.parent.A=f(r,o,r.parent.A||u[0])}function h(r){r._.x=r.z+r.parent.m,r.m+=r.parent.m}function f(r,l,u){if(l){for(var o=r,d=r,_=l,$=o.parent.children[0],x=o.m,p=d.m,g=_.m,w=$.m,y;_=b(_),o=M(o),_&&o;)$=M($),d=b(d),d.a=r,y=_.z+g-o.z-x+e(_._,o._),y>0&&(_t($t(_,r,u),r,y),x+=y,p+=y),g+=_.m,x+=o.m,w+=$.m,p+=d.m;_&&!b(d)&&(d.t=_,d.m+=g-p),o&&!M($)&&($.t=o,$.m+=x-w,u=r)}return u}function c(r){r.x*=t,r.y=r.depth*n}return s.separation=function(r){return arguments.length?(e=r,s):e},s.size=function(r){return arguments.length?(i=!1,t=+r[0],n=+r[1],s):i?null:[t,n]},s.nodeSize=function(r){return arguments.length?(i=!0,t=+r[0],n=+r[1],s):i?[t,n]:null},s}function E(e){return function(){return e}}function mt(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new V(t)}var wt=Array.prototype.slice;function zt(e){return e[0]}function kt(e){return e[1]}class At{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function Mt(e){return new At(e,!0)}function bt(e){return e.source}function Tt(e){return e.target}function Bt(e){let t=bt,n=Tt,i=zt,s=kt,a=null,h=null,f=mt(c);function c(){let r;const l=wt.call(arguments),u=t.apply(this,l),o=n.apply(this,l);if(a==null&&(h=e(r=f())),h.lineStart(),l[0]=u,h.point(+i.apply(this,l),+s.apply(this,l)),l[0]=o,h.point(+i.apply(this,l),+s.apply(this,l)),h.lineEnd(),r)return h=null,r+""||null}return c.source=function(r){return arguments.length?(t=r,c):t},c.target=function(r){return arguments.length?(n=r,c):n},c.x=function(r){return arguments.length?(i=typeof r=="function"?r:E(+r),c):i},c.y=function(r){return arguments.length?(s=typeof r=="function"?r:E(+r),c):s},c.context=function(r){return arguments.length?(r==null?a=h=null:h=e(a=r),c):a},c}function St(){return Bt(Mt)}const L="tree-container",Nt=P({__name:"Tree",setup(e){H(i=>({"7d7123c1":A(q),"232a636c":A(j),"4d1ebb94":A(G)}));async function t(){let i=null;return i===null&&(i=(await v.get("/api/tree")).data),i}const n=async i=>{const s=window.innerWidth,a=window.innerHeight-42,h={top:16,right:.1*s+.12*a,left:.12*s,bottom:20},f=s-h.left-h.right,c=a-h.top-h.bottom,r=Z(`#${L}`);r.select("svg").remove();const u=r.append("svg").attr("width",s).attr("height",a).append("g").attr("transform",`translate(${h.left},${h.top})`),o=yt().size([c,f]),d=S(await t()),_=o(d).links(),$=St().x(p=>p.y).y(p=>p.x),x=u.append("g");i&&(x.attr("transform","scale(0, 1)").attr("stroke-opacity",0),D(x,550).attr("transform","scale(1, 1)").attr("stroke-opacity","100%")),x.selectAll(".link").data(_).enter().append("path").attr("class","link").attr("d",$),u.selectAll("text").data(d.descendants()).enter().append("text").attr("class","tree-text").attr("x",p=>p.y).attr("y",p=>p.x).attr("dy","0.32em").attr("text-anchor",p=>p.children?"middle":"start").attr("font-size",p=>(27-6.5*p.depth)*(c/1e3)).text(p=>p.data.id)};return R(()=>{n(!0),window.addEventListener("resize",()=>{n(!1)})}),(i,s)=>(I(),W("div",{id:L,style:{position:"absolute","line-height":"0"}}))}});export{Nt as default};
